#' Apply automatic grading to a problem object
#'
#' @param problem A problem generated by a `tbl_check_*()` function.
#' @inheritParams tbl_check_table
#'
#' @return A [gradethis::fail()] message.
#' @export
#' 
#' @examples
#' .result <- 1:10
#' .solution <- letters[1:10]
#' problem <- tbl_check_vector()
#' tbl_grade(problem)
tbl_grade <- function(problem, max_diffs = 3) {
  if (is.null(problem) || isFALSE(problem$message)) {
    return(invisible())
  }
  
  assert_internally({
    checkmate::assert_class(problem, "tblcheck_problem")
    checkmate::assert_number(max_diffs, lower = 1)
  })
  
  return_fail(
    tbl_message(problem, max_diffs = max_diffs),
    problem = problem
  )
}

tbl_message <- function(problem, ...) {
  UseMethod("tbl_message")
}

isFALSE <- function(x) {
  is.logical(x) && length(x) == 1L && !is.na(x) && !x
}
